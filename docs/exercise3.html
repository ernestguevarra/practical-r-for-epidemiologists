<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Practical R for Epidemiologists</title>
  <meta name="description" content="This guide is intended as a practical introduction to using the R environment for data analysis and graphics to work with epidemiological data. Topics covered include univariate statistics, simple statistical inference, charting data, two-by-two tables, stratified analysis, chi-square test for trend, logistic regression, survival analysis, computer-intensive methods, and extending R using user-provided functions. You should be able to follow the material if you are reasonably familiar with the mechanics of statistical estimation (e.g. calculation of odds ratios and confidence intervals) and require a system that can perform simple or complex analyses to your exact specifications. If you are interested in a system that is flexible, can be tailored to produce exactly the analysis you want, provides modern analytical facilities, and have a basic understanding of the mechanics of hypothesis testing and estimation then you should consider purchasing this book.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Practical R for Epidemiologists" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://guevarra.io/practical-r-for-epidemiologists/" />
  <meta property="og:image" content="https://guevarra.io/practical-r-for-epidemiologists/images/bookcover.jpg" />
  <meta property="og:description" content="This guide is intended as a practical introduction to using the R environment for data analysis and graphics to work with epidemiological data. Topics covered include univariate statistics, simple statistical inference, charting data, two-by-two tables, stratified analysis, chi-square test for trend, logistic regression, survival analysis, computer-intensive methods, and extending R using user-provided functions. You should be able to follow the material if you are reasonably familiar with the mechanics of statistical estimation (e.g. calculation of odds ratios and confidence intervals) and require a system that can perform simple or complex analyses to your exact specifications. If you are interested in a system that is flexible, can be tailored to produce exactly the analysis you want, provides modern analytical facilities, and have a basic understanding of the mechanics of hypothesis testing and estimation then you should consider purchasing this book." />
  <meta name="github-repo" content="ernestguevarra/practical-r-for-epidemiologists" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Practical R for Epidemiologists" />
  
  <meta name="twitter:description" content="This guide is intended as a practical introduction to using the R environment for data analysis and graphics to work with epidemiological data. Topics covered include univariate statistics, simple statistical inference, charting data, two-by-two tables, stratified analysis, chi-square test for trend, logistic regression, survival analysis, computer-intensive methods, and extending R using user-provided functions. You should be able to follow the material if you are reasonably familiar with the mechanics of statistical estimation (e.g. calculation of odds ratios and confidence intervals) and require a system that can perform simple or complex analyses to your exact specifications. If you are interested in a system that is flexible, can be tailored to produce exactly the analysis you want, provides modern analytical facilities, and have a basic understanding of the mechanics of hypothesis testing and estimation then you should consider purchasing this book." />
  <meta name="twitter:image" content="https://guevarra.io/practical-r-for-epidemiologists/images/bookcover.jpg" />

<meta name="author" content="Mark Myatt and Ernest Guevarra">


<meta name="date" content="2018-05-14">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="exercise2.html">
<link rel="next" href="exercise4.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-118912078-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-118912078-1');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Practical R for Epidemiologists</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="introducing-r.html"><a href="introducing-r.html"><i class="fa fa-check"></i>Introducing R</a><ul>
<li class="chapter" data-level="" data-path="introducing-r.html"><a href="introducing-r.html#retrieving-data"><i class="fa fa-check"></i>Retrieving data</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="exercise1.html"><a href="exercise1.html"><i class="fa fa-check"></i><b>1</b> Getting acquainted with R</a><ul>
<li class="chapter" data-level="1.1" data-path="exercise1.html"><a href="exercise1.html#summary"><i class="fa fa-check"></i><b>1.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exercise2.html"><a href="exercise2.html"><i class="fa fa-check"></i><b>2</b> Manipulating objects and creating new functions</a><ul>
<li class="chapter" data-level="2.1" data-path="exercise2.html"><a href="exercise2.html#summary-1"><i class="fa fa-check"></i><b>2.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exercise3.html"><a href="exercise3.html"><i class="fa fa-check"></i><b>3</b> Logistic regression and stratified analysis</a><ul>
<li class="chapter" data-level="3.1" data-path="exercise3.html"><a href="exercise3.html#matched-data"><i class="fa fa-check"></i><b>3.1</b> Matched data</a></li>
<li class="chapter" data-level="3.2" data-path="exercise3.html"><a href="exercise3.html#summary-2"><i class="fa fa-check"></i><b>3.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exercise4.html"><a href="exercise4.html"><i class="fa fa-check"></i><b>4</b> Analysing some data with R</a><ul>
<li class="chapter" data-level="4.1" data-path="exercise4.html"><a href="exercise4.html#summary-3"><i class="fa fa-check"></i><b>4.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exercise5.html"><a href="exercise5.html"><i class="fa fa-check"></i><b>5</b> Extending R with packages</a><ul>
<li class="chapter" data-level="5.1" data-path="exercise5.html"><a href="exercise5.html#summary-4"><i class="fa fa-check"></i><b>5.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="exercise6.html"><a href="exercise6.html"><i class="fa fa-check"></i><b>6</b> Making your own objects behave like R objects</a><ul>
<li class="chapter" data-level="6.1" data-path="exercise6.html"><a href="exercise6.html#summary-5"><i class="fa fa-check"></i><b>6.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="exercise7.html"><a href="exercise7.html"><i class="fa fa-check"></i><b>7</b> Writing your own graphical functions</a><ul>
<li class="chapter" data-level="7.1" data-path="exercise7.html"><a href="exercise7.html#summary-6"><i class="fa fa-check"></i><b>7.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="exercise8.html"><a href="exercise8.html"><i class="fa fa-check"></i><b>8</b> More graphical functions</a><ul>
<li class="chapter" data-level="8.1" data-path="exercise8.html"><a href="exercise8.html#population-pyramid"><i class="fa fa-check"></i><b>8.1</b> Population pyramid</a></li>
<li class="chapter" data-level="8.2" data-path="exercise8.html"><a href="exercise8.html#pareto-chart"><i class="fa fa-check"></i><b>8.2</b> Pareto chart</a></li>
<li class="chapter" data-level="8.3" data-path="exercise8.html"><a href="exercise8.html#adding-confidence-intervals-or-error-bars-on-plots"><i class="fa fa-check"></i><b>8.3</b> Adding confidence intervals or error bars on plots</a></li>
<li class="chapter" data-level="8.4" data-path="exercise8.html"><a href="exercise8.html#mesh-map"><i class="fa fa-check"></i><b>8.4</b> Mesh map</a></li>
<li class="chapter" data-level="8.5" data-path="exercise8.html"><a href="exercise8.html#combining-plots"><i class="fa fa-check"></i><b>8.5</b> Combining plots</a></li>
<li class="chapter" data-level="8.6" data-path="exercise8.html"><a href="exercise8.html#summary-7"><i class="fa fa-check"></i><b>8.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="exercise9.html"><a href="exercise9.html"><i class="fa fa-check"></i><b>9</b> Computer intensive methods</a><ul>
<li class="chapter" data-level="9.1" data-path="exercise9.html"><a href="exercise9.html#estimation"><i class="fa fa-check"></i><b>9.1</b> Estimation</a></li>
<li class="chapter" data-level="9.2" data-path="exercise9.html"><a href="exercise9.html#hypothesis-testing"><i class="fa fa-check"></i><b>9.2</b> Hypothesis testing</a></li>
<li class="chapter" data-level="9.3" data-path="exercise9.html"><a href="exercise9.html#simulating-processes"><i class="fa fa-check"></i><b>9.3</b> Simulating processes</a></li>
<li class="chapter" data-level="9.4" data-path="exercise9.html"><a href="exercise9.html#cellular-automata-machines"><i class="fa fa-check"></i><b>9.4</b> Cellular automata machines</a></li>
<li class="chapter" data-level="9.5" data-path="exercise9.html"><a href="exercise9.html#summary-8"><i class="fa fa-check"></i><b>9.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="what-now.html"><a href="what-now.html"><i class="fa fa-check"></i>What now?</a></li>
<li class="divider"></li>
<li>&nbsp; &nbsp; @ Mark Myatt and Ernest Guevarra 2018</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Practical R for Epidemiologists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exercise3" class="section level1">
<h1><span class="header-section-number">Exercise 3</span> Logistic regression and stratified analysis</h1>
<p>In this exercise we will explore how <code>R</code> handles generalised linear models using the example of logistic regression. We will continue using the <code>salex</code> dataset. Start <code>R</code> and retrieve the <code>salex</code> dataset:</p>
<p> </p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb211-1" data-line-number="1">salex &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;salex.dat&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">na.strings =</span> <span class="st">&quot;9&quot;</span>)</a></code></pre></div>
<p> </p>
<p>When we analysed this data using two-by-two tables and examining the risk ratio and 95% confidence interval associated with each exposure we found many significant positive associations:</p>
<p> </p>
<table style="width:67%;">
<colgroup>
<col width="22%" />
<col width="15%" />
<col width="29%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Variable</strong></th>
<th><strong>RR</strong></th>
<th><strong>95% CI</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>EGGS</td>
<td>2.61</td>
<td>1.55, 4.38</td>
</tr>
<tr class="even">
<td>MUSHROOM</td>
<td>1.41</td>
<td>1.03, 1.93</td>
</tr>
<tr class="odd">
<td>PEPPER</td>
<td>1.74</td>
<td>1.27, 2.38</td>
</tr>
<tr class="even">
<td>PASTA</td>
<td>1.68</td>
<td>1.26, 2.26</td>
</tr>
<tr class="odd">
<td>RICE</td>
<td>1.72</td>
<td>1.25, 2.34</td>
</tr>
<tr class="even">
<td>LETTUCE</td>
<td>2.01</td>
<td>1.49, 2.73</td>
</tr>
<tr class="odd">
<td>COLESLAW</td>
<td>1.89</td>
<td>1.37, 2.64</td>
</tr>
<tr class="even">
<td>CHOCOLATE</td>
<td>1.39</td>
<td>1.05, 1.87</td>
</tr>
</tbody>
</table>
<p> </p>
<p>Some of these associations may be due to <em>confounding</em> in the data. We can use logistic regression to help us identify independent associations.</p>
<p>Logistic regression requires the dependent variable to be either 0 or 1. In order to perform a logistic regression we must first recode the <code>ILL</code> variable so that 0=no and 1=yes:</p>
<p> </p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb212-1" data-line-number="1"><span class="kw">table</span>(salex<span class="op">$</span>ILL)</a>
<a class="sourceLine" id="cb212-2" data-line-number="2">salex<span class="op">$</span>ILL[salex<span class="op">$</span>ILL <span class="op">==</span><span class="st"> </span><span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb212-3" data-line-number="3"><span class="kw">table</span>(salex<span class="op">$</span>ILL)</a></code></pre></div>
<pre><code>## 
##  1  2 
## 51 26</code></pre>
<pre><code>## 
##  0  1 
## 26 51</code></pre>
<p> </p>
<p>We could work with our data as it is but if we wanted to calculate odds ratios and confidence intervals we would calculate their reciprocals (i.e. odds ratios for non-exposure rather than for exposure). This is because of the way the data has been coded (1=yes, 2=no).</p>
<p>In order to calculate meaningful odds ratios the exposure variables should also be coded 0=no, 1=yes. The actual codes used are not important as long as the value used for ‘exposed’ is one greater than the value used for ‘not exposed’.</p>
<p>We could issue a series of commands similar to the one we have just used to recode the <code>ILL</code> variable. This is both tedious and unnecessary as the structure of the dataset (i.e. all variables are coded identically) allows us to recode all variables with a single command:</p>
<p> </p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb215-1" data-line-number="1">salex &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;salex.dat&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">na.strings =</span> <span class="st">&quot;9&quot;</span>)</a>
<a class="sourceLine" id="cb215-2" data-line-number="2">salex[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, ]</a></code></pre></div>
<pre><code>##   ILL HAM BEEF EGGS MUSHROOM PEPPER PORKPIE PASTA RICE LETTUCE TOMATO
## 1   1   1    1    1        1      1       2     2    2       2      2
## 2   1   1    1    1        2      2       1     2    2       2      1
## 3   1   1    1    1        1      1       1     1    1       1      2
## 4   1   1    1    1        2      2       2     2    2       1      1
## 5   1   1    1    1        1      1       1     1    1       1      1
##   COLESLAW CRISPS PEACHCAKE CHOCOLATE FRUIT TRIFLE ALMONDS
## 1        2      2         2         2     2      2       2
## 2        2      2         2         2     2      2       2
## 3        2      1         2         1     2      2       2
## 4        2      2         2         1     2      2       2
## 5        1      2         2         1     2      1       2</code></pre>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb217-1" data-line-number="1">salex &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>salex</a>
<a class="sourceLine" id="cb217-2" data-line-number="2">salex[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, ]</a></code></pre></div>
<pre><code>##   ILL HAM BEEF EGGS MUSHROOM PEPPER PORKPIE PASTA RICE LETTUCE TOMATO
## 1   1   1    1    1        1      1       0     0    0       0      0
## 2   1   1    1    1        0      0       1     0    0       0      1
## 3   1   1    1    1        1      1       1     1    1       1      0
## 4   1   1    1    1        0      0       0     0    0       1      1
## 5   1   1    1    1        1      1       1     1    1       1      1
##   COLESLAW CRISPS PEACHCAKE CHOCOLATE FRUIT TRIFLE ALMONDS
## 1        0      0         0         0     0      0       0
## 2        0      0         0         0     0      0       0
## 3        0      1         0         1     0      0       0
## 4        0      0         0         1     0      0       0
## 5        1      0         0         1     0      1       0</code></pre>
<p> </p>
<p><strong><em>WARNING</em></strong> : The <code>attach()</code> function works with a copy of the data.frame rather than the original data.frame. Commands that manipulate variables in a data.frame may not work as expected if the data.frame has been attached using the <code>attach()</code> function.</p>
<p>It is better to manipulate data <strong><em>before</em></strong> attaching a data.frame. The <code>detach()</code> function may be used to remove an attachment prior to any data manipulation.</p>
<p>Many <code>R</code> users avoid using the <code>attach()</code> function altogether.</p>
<p>We can now use the generalised linear model <code>glm()</code> function to specify the logistic regression model:</p>
<p> </p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb219-1" data-line-number="1">salex.lreg &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="dt">formula =</span> ILL <span class="op">~</span><span class="st"> </span>EGGS <span class="op">+</span><span class="st"> </span>MUSHROOM <span class="op">+</span><span class="st"> </span>PEPPER <span class="op">+</span><span class="st"> </span>PASTA <span class="op">+</span></a>
<a class="sourceLine" id="cb219-2" data-line-number="2"><span class="st">                  </span>RICE <span class="op">+</span><span class="st"> </span>LETTUCE <span class="op">+</span><span class="st"> </span>COLESLAW <span class="op">+</span><span class="st"> </span>CHOCOLATE,</a>
<a class="sourceLine" id="cb219-3" data-line-number="3">                  <span class="dt">family =</span> <span class="kw">binomial</span>(logit), <span class="dt">data =</span> salex)</a></code></pre></div>
<p> </p>
<p>The method used by the <code>glm()</code> function is defined by the <code>family</code> parameter. Here we specify <code>binomial</code> errors and a <code>logit</code> (logistic) linking function.</p>
<p>We have saved the output of the <code>glm()</code> function in the <code>salex.lreg</code> object. We can examine some basic information about the specified model using the <code>summary()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" data-line-number="1"><span class="kw">summary</span>(salex.lreg)</a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = ILL ~ EGGS + MUSHROOM + PEPPER + PASTA + RICE + 
##     LETTUCE + COLESLAW + CHOCOLATE, family = binomial(logit), 
##     data = salex)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.92036  -0.49869   0.06877   0.40906   2.07182  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept) -2.021864   0.676606  -2.988  0.00281 **
## EGGS         3.579366   1.267870   2.823  0.00476 **
## MUSHROOM    -3.584345   1.728999  -2.073  0.03817 * 
## PEPPER       2.348074   1.428177   1.644  0.10015   
## PASTA        1.774818   1.162762   1.526  0.12692   
## RICE         0.114180   1.193840   0.096  0.92381   
## LETTUCE      3.401828   1.234060   2.757  0.00584 **
## COLESLAW     0.763857   1.024373   0.746  0.45586   
## CHOCOLATE    0.009782   1.314683   0.007  0.99406   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 91.246  on 69  degrees of freedom
## Residual deviance: 41.260  on 61  degrees of freedom
##   (7 observations deleted due to missingness)
## AIC: 59.26
## 
## Number of Fisher Scoring iterations: 7</code></pre>
<p> </p>
<p>We will use <em>backwards elimination</em> to remove non-significant variables from the logistic regression model. Remember that previous commands can be recalled and edited using the up and down arrow keys – they do not need to be typed out in full each time.</p>

<p><code>CHOCOLATE</code> is the least significant variable in the model so we will remove this variable from the model. Storing the output of the <code>glm()</code> function is useful as it allows us to use the <code>update()</code> function to add, remove, or modify variables without having to describe the model in full:</p>
<p> </p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb222-1" data-line-number="1">salex.lreg &lt;-<span class="st"> </span><span class="kw">update</span>(salex.lreg, . <span class="op">~</span><span class="st"> </span>. <span class="op">-</span><span class="st"> </span>CHOCOLATE)</a>
<a class="sourceLine" id="cb222-2" data-line-number="2"><span class="kw">summary</span>(salex.lreg)</a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = ILL ~ EGGS + MUSHROOM + PEPPER + PASTA + RICE + 
##     LETTUCE + COLESLAW, family = binomial(logit), data = salex)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.92561  -0.49859   0.07555   0.38723   2.07200  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)  -2.0223     0.6623  -3.053  0.00226 **
## EGGS          3.5890     1.2188   2.945  0.00323 **
## MUSHROOM     -3.5992     1.6885  -2.132  0.03305 * 
## PEPPER        2.3544     1.4275   1.649  0.09910 . 
## PASTA         1.7770     1.1215   1.585  0.11308   
## RICE          0.1170     1.1388   0.103  0.91819   
## LETTUCE       3.4109     1.2316   2.770  0.00561 **
## COLESLAW      0.7630     1.0224   0.746  0.45547   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 92.122  on 70  degrees of freedom
## Residual deviance: 41.273  on 63  degrees of freedom
##   (6 observations deleted due to missingness)
## AIC: 57.273
## 
## Number of Fisher Scoring iterations: 7</code></pre>

<p><code>RICE</code> is now the least significant variable in the model so we will remove this variable from the model:</p>
<p> </p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" data-line-number="1">salex.lreg &lt;-<span class="st"> </span><span class="kw">update</span>(salex.lreg, . <span class="op">~</span><span class="st"> </span>. <span class="op">-</span><span class="st"> </span>RICE)</a>
<a class="sourceLine" id="cb224-2" data-line-number="2"><span class="kw">summary</span>(salex.lreg)</a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = ILL ~ EGGS + MUSHROOM + PEPPER + PASTA + LETTUCE + 
##     COLESLAW, family = binomial(logit), data = salex)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.8877  -0.4999   0.0786   0.3897   2.0697  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)  -2.0169     0.6600  -3.056  0.00224 **
## EGGS          3.6142     1.1944   3.026  0.00248 **
## MUSHROOM     -3.5508     1.6134  -2.201  0.02774 * 
## PEPPER        2.3002     1.3200   1.743  0.08141 . 
## PASTA         1.8230     1.0280   1.773  0.07617 . 
## LETTUCE       3.4199     1.2273   2.787  0.00533 **
## COLESLAW      0.7611     1.0203   0.746  0.45571   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 92.122  on 70  degrees of freedom
## Residual deviance: 41.283  on 64  degrees of freedom
##   (6 observations deleted due to missingness)
## AIC: 55.283
## 
## Number of Fisher Scoring iterations: 6</code></pre>

<p><code>COLESLAW</code> is now the least significant variable in the model so we will remove this variable from the model:</p>
<p> </p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" data-line-number="1">salex.lreg &lt;-<span class="st"> </span><span class="kw">update</span>(salex.lreg, . <span class="op">~</span><span class="st"> </span>. <span class="op">-</span><span class="st"> </span>COLESLAW)</a>
<a class="sourceLine" id="cb226-2" data-line-number="2"><span class="kw">summary</span>(salex.lreg)</a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = ILL ~ EGGS + MUSHROOM + PEPPER + PASTA + LETTUCE, 
##     family = binomial(logit), data = salex)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.98481  -0.50486   0.08871   0.36910   2.06065  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)  -1.9957     0.6545  -3.049  0.00230 **
## EGGS          3.8152     1.1640   3.278  0.00105 **
## MUSHROOM     -3.4008     1.5922  -2.136  0.03269 * 
## PEPPER        2.3520     1.3269   1.773  0.07631 . 
## PASTA         1.9706     0.9922   1.986  0.04701 * 
## LETTUCE       3.4786     1.2246   2.841  0.00450 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 92.982  on 71  degrees of freedom
## Residual deviance: 41.895  on 66  degrees of freedom
##   (5 observations deleted due to missingness)
## AIC: 53.895
## 
## Number of Fisher Scoring iterations: 6</code></pre>

<p><code>PEPPER</code> is now the least significant variable in the model so we will remove this variable from the model:</p>
<p> </p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" data-line-number="1">salex.lreg &lt;-<span class="st"> </span><span class="kw">update</span>(salex.lreg, . <span class="op">~</span><span class="st"> </span>. <span class="op">-</span><span class="st"> </span>PEPPER)</a>
<a class="sourceLine" id="cb228-2" data-line-number="2"><span class="kw">summary</span>(salex.lreg)</a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = ILL ~ EGGS + MUSHROOM + PASTA + LETTUCE, family = binomial(logit), 
##     data = salex)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.0920  -0.5360   0.1109   0.4876   2.0056  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -1.8676     0.6128  -3.048 0.002306 ** 
## EGGS          3.7094     1.0682   3.473 0.000515 ***
## MUSHROOM     -1.6165     1.0829  -1.493 0.135524    
## PASTA         1.8440     0.9193   2.006 0.044864 *  
## LETTUCE       3.2458     1.1698   2.775 0.005527 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 94.659  on 73  degrees of freedom
## Residual deviance: 45.578  on 69  degrees of freedom
##   (3 observations deleted due to missingness)
## AIC: 55.578
## 
## Number of Fisher Scoring iterations: 6</code></pre>

<p><code>MUSHROOM</code> is now the least significant variable in the model so we will remove this variable from the model:</p>
<p> </p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" data-line-number="1">salex.lreg &lt;-<span class="st"> </span><span class="kw">update</span>(salex.lreg, . <span class="op">~</span><span class="st"> </span>. <span class="op">-</span><span class="st"> </span>MUSHROOM)</a>
<a class="sourceLine" id="cb230-2" data-line-number="2"><span class="kw">summary</span>(salex.lreg)</a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = ILL ~ EGGS + PASTA + LETTUCE, family = binomial(logit), 
##     data = salex)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.2024  -0.5108   0.2038   0.4304   2.0501  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -1.9710     0.6146  -3.207  0.00134 ** 
## EGGS          2.6391     0.7334   3.599  0.00032 ***
## PASTA         1.6646     0.8376   1.987  0.04689 *  
## LETTUCE       3.1956     1.1516   2.775  0.00552 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 97.648  on 75  degrees of freedom
## Residual deviance: 50.529  on 72  degrees of freedom
##   (1 observation deleted due to missingness)
## AIC: 58.529
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p> </p>
<p>There are now no non-significant variables in the model.</p>

<p>Unfortunately <code>R</code> does not present information on the model coefficients in terms of odds ratios and confidence intervals but we can write a function to calculate them for us.</p>
<p>The first step in doing this is to realise that the <code>salex.lreg</code> object contains essential information about the fitted model. To calculate odds ratios and confidence intervals we need the regression coefficients and their standard errors. Both:</p>
<p> </p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" data-line-number="1"><span class="kw">summary</span>(salex.lreg)<span class="op">$</span>coefficients</a></code></pre></div>
<pre><code>##              Estimate Std. Error   z value     Pr(&gt;|z|)
## (Intercept) -1.970967  0.6145691 -3.207071 0.0013409398
## EGGS         2.639115  0.7333899  3.598515 0.0003200388
## PASTA        1.664581  0.8375970  1.987330 0.0468858898
## LETTUCE      3.195594  1.1516159  2.774879 0.0055222320</code></pre>
<p> </p>
<p>and:</p>
<p> </p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" data-line-number="1"><span class="kw">coef</span>(<span class="kw">summary</span>(salex.lreg))</a></code></pre></div>
<pre><code>##              Estimate Std. Error   z value     Pr(&gt;|z|)
## (Intercept) -1.970967  0.6145691 -3.207071 0.0013409398
## EGGS         2.639115  0.7333899  3.598515 0.0003200388
## PASTA        1.664581  0.8375970  1.987330 0.0468858898
## LETTUCE      3.195594  1.1516159  2.774879 0.0055222320</code></pre>
<p> </p>
<p>extract the data that we require. The preferred method is to use the <code>coef()</code> function. This is because some fitted models may return coefficients in a more complicated manner than (e.g.) those created by the <code>glm()</code> function. The <code>coef()</code> function provides a standard way of extracting this data from all classes of fitted objects.</p>

<p>We can store the <code>coefficients</code> data in a separate object to make it easier to work with:</p>
<p> </p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb236-1" data-line-number="1">salex.lreg.coeffs &lt;-<span class="st"> </span><span class="kw">coef</span>(<span class="kw">summary</span>(salex.lreg))</a>
<a class="sourceLine" id="cb236-2" data-line-number="2">salex.lreg.coeffs</a></code></pre></div>
<pre><code>##              Estimate Std. Error   z value     Pr(&gt;|z|)
## (Intercept) -1.970967  0.6145691 -3.207071 0.0013409398
## EGGS         2.639115  0.7333899  3.598515 0.0003200388
## PASTA        1.664581  0.8375970  1.987330 0.0468858898
## LETTUCE      3.195594  1.1516159  2.774879 0.0055222320</code></pre>
<p> </p>
<p>We can extract information from this object by addressing each piece of information by its row and column position in the object. For example:</p>
<p> </p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb238-1" data-line-number="1">salex.lreg.coeffs[<span class="dv">2</span>,<span class="dv">1</span>]</a></code></pre></div>
<pre><code>## [1] 2.639115</code></pre>
<p> </p>
<p>Is the regression coefficient for <code>EGGS</code>, and:</p>
<p> </p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb240-1" data-line-number="1">salex.lreg.coeffs[<span class="dv">3</span>,<span class="dv">2</span>]</a></code></pre></div>
<pre><code>## [1] 0.837597</code></pre>
<p> </p>
<p>is the standard error of the regression coefficient for <code>PASTA</code>. Similarly:</p>
<p> </p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb242-1" data-line-number="1">salex.lreg.coeffs[ ,<span class="dv">1</span>]</a></code></pre></div>
<pre><code>## (Intercept)        EGGS       PASTA     LETTUCE 
##   -1.970967    2.639115    1.664581    3.195594</code></pre>

<p>Returns the regression coefficients for all of the variables in the model, and:</p>
<p> </p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" data-line-number="1">salex.lreg.coeffs[ ,<span class="dv">2</span>]</a></code></pre></div>
<pre><code>## (Intercept)        EGGS       PASTA     LETTUCE 
##   0.6145691   0.7333899   0.8375970   1.1516159</code></pre>
<p> </p>
<p>Returns the standard errors of the regression coefficients.</p>
<p>The table below shows the indices that address each cell in the table of regression coefficients:</p>
<p> </p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb246-1" data-line-number="1"><span class="kw">matrix</span>(salex.lreg.coeffs, <span class="dt">nrow =</span> <span class="dv">4</span>, <span class="dt">ncol =</span> <span class="dv">4</span>)</a></code></pre></div>
<pre><code>##           [,1]      [,2]      [,3]         [,4]
## [1,] -1.970967 0.6145691 -3.207071 0.0013409398
## [2,]  2.639115 0.7333899  3.598515 0.0003200388
## [3,]  1.664581 0.8375970  1.987330 0.0468858898
## [4,]  3.195594 1.1516159  2.774879 0.0055222320</code></pre>
<p> </p>
<p>We can use this information to calculate odds ratio sand 95% confidence intervals:</p>
<p> </p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb248-1" data-line-number="1">or &lt;-<span class="st"> </span><span class="kw">exp</span>(salex.lreg.coeffs[ ,<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb248-2" data-line-number="2">lci &lt;-<span class="st"> </span><span class="kw">exp</span>(salex.lreg.coeffs[ ,<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>salex.lreg.coeffs[ ,<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb248-3" data-line-number="3">uci &lt;-<span class="st"> </span><span class="kw">exp</span>(salex.lreg.coeffs[ ,<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>salex.lreg.coeffs[ ,<span class="dv">2</span>])</a></code></pre></div>
<p> </p>
<p>and make a single object that contains all of the required information:</p>
<p> </p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb249-1" data-line-number="1">lreg.or &lt;-<span class="st"> </span><span class="kw">cbind</span>(or, lci, uci)</a>
<a class="sourceLine" id="cb249-2" data-line-number="2">lreg.or</a></code></pre></div>
<pre><code>##                     or       lci         uci
## (Intercept)  0.1393221 0.0417723   0.4646777
## EGGS        14.0008053 3.3256684  58.9423019
## PASTA        5.2834608 1.0231552  27.2832114
## LETTUCE     24.4246856 2.5559581 233.4018193</code></pre>
<p> </p>
<p>We seldom need to report estimates and confidence intervals to more than two decimal places. We can use the <code>round()</code> function to remove the excess digits:</p>
<p> </p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb251-1" data-line-number="1"><span class="kw">round</span>(lreg.or, <span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##                or  lci    uci
## (Intercept)  0.14 0.04   0.46
## EGGS        14.00 3.33  58.94
## PASTA        5.28 1.02  27.28
## LETTUCE     24.42 2.56 233.40</code></pre>
<p> </p>
<p>We have now gone through all the necessary calculations step-by-step but it would be nice to have a function that did it all for us that we could use whenever we needed to.</p>
<p>First we will create a template for the function:</p>
<p> </p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb253-1" data-line-number="1">lreg.or &lt;-<span class="st"> </span><span class="cf">function</span>(model, <span class="dt">digits =</span> <span class="dv">2</span>) {}</a></code></pre></div>
<p> </p>
<p>and then use the <code>fix()</code> function to edit the <code>lreg.or()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb254-1" data-line-number="1"><span class="kw">fix</span>(lreg.or)</a></code></pre></div>
<p> </p>
<p>We can now edit this function to add a calculation of odds ratios and 95% confidence intervals:</p>
<p> </p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb255-1" data-line-number="1"><span class="cf">function</span>(model, <span class="dt">digits =</span> <span class="dv">2</span>) {</a>
<a class="sourceLine" id="cb255-2" data-line-number="2">  lreg.coeffs &lt;-<span class="st"> </span><span class="kw">coef</span>(<span class="kw">summary</span>(model))</a>
<a class="sourceLine" id="cb255-3" data-line-number="3">  OR &lt;-<span class="st"> </span><span class="kw">exp</span>(lreg.coeffs[ ,<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb255-4" data-line-number="4">  LCI &lt;-<span class="st"> </span><span class="kw">exp</span>(lreg.coeffs[ ,<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>lreg.coeffs[ ,<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb255-5" data-line-number="5">  UCI &lt;-<span class="st"> </span><span class="kw">exp</span>(lreg.coeffs[ ,<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>lreg.coeffs[ ,<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb255-6" data-line-number="6">  lreg.or &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">cbind</span>(OR, LCI, UCI), <span class="dt">digits =</span> digits)</a>
<a class="sourceLine" id="cb255-7" data-line-number="7">  lreg.or</a>
<a class="sourceLine" id="cb255-8" data-line-number="8">}</a></code></pre></div>

<p>Once you have made the changes shown above, check your work, save the file, and quit the editor.</p>
<p>We can test our function:</p>
<p> </p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb256-1" data-line-number="1"><span class="kw">lreg.or</span>(salex.lreg)</a></code></pre></div>
<p> </p>
<p>Which produces the following output:</p>
<p> </p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" data-line-number="1"><span class="kw">lreg.or</span>(salex.lreg)</a></code></pre></div>
<pre><code>##                OR  LCI    UCI
## (Intercept)  0.14 0.04   0.46
## EGGS        14.00 3.33  58.94
## PASTA        5.28 1.02  27.28
## LETTUCE     24.42 2.56 233.40</code></pre>
<p> </p>
<p>The <code>digits</code> parameter of the <code>lreg.or()</code> function, which has <code>digits = 2</code> as its default value, allows us to specify the precision with which the estimates and their confidence intervals are reported:</p>
<p> </p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" data-line-number="1"><span class="kw">lreg.or</span>(salex.lreg, <span class="dt">digits =</span> <span class="dv">4</span>)</a></code></pre></div>
<pre><code>##                  OR    LCI      UCI
## (Intercept)  0.1393 0.0418   0.4647
## EGGS        14.0008 3.3257  58.9423
## PASTA        5.2835 1.0232  27.2832
## LETTUCE     24.4247 2.5560 233.4018</code></pre>
<p> </p>
<p>Before we continue, it is probably a good idea to save this function for later use:</p>
<p> </p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb261-1" data-line-number="1"><span class="kw">save</span>(lreg.or, <span class="dt">file =</span> <span class="st">&quot;lregor.r&quot;</span>)</a></code></pre></div>

<p>Which can be reloaded whenever it is needed:</p>
<p> </p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb262-1" data-line-number="1"><span class="kw">load</span>(<span class="st">&quot;lregor.r&quot;</span>)</a></code></pre></div>
<p> </p>
<p>An alternative to using logistic regression with data that contains associations that may be due to confounding is to use stratified analysis (i.e. <em>Mantel-Haenszel</em> techniques). With several potential confounders, a stratified analysis results in the analysis of many tables which can be difficult to interpret. For example, four potential confounders, each with two levels would produce sixteen tables. In such situations, logistic regression might be a better approach. In order to illustrate Mantel-Haenszel techniques in <code>R</code> we will work with a simpler dataset.</p>
<p>On Saturday, 21st April 1990, a luncheon was held in the home of Jean Bateman. There was a total of forty-five guests which included thirty-five members of the Department of Epidemiology and Population Sciences at the London School of Hygiene and Tropical Medicine. On Sunday morning, 22nd April 1990, Jean awoke with symptoms of gastrointestinal illness; her husband awoke with similar symptoms. The possibility of an outbreak related to the luncheon was strengthened when several of the guests telephoned Jean on Sunday and reported illness. On Monday, 23rd April 1990, there was an unusually large number of department members absent from work and reporting illness. Data from this outbreak is stored in the file <code>bateman.dat</code>.</p>
<p>The variables in the file <code>bateman.dat</code> are:</p>
<p> </p>
<table style="width:69%;">
<colgroup>
<col width="22%" />
<col width="47%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>ILL</strong></td>
<td>Ill?</td>
</tr>
<tr class="even">
<td><strong>CHEESE</strong></td>
<td>Cheddar cheese</td>
</tr>
<tr class="odd">
<td><strong>CRABDIP</strong></td>
<td>Crab dip</td>
</tr>
<tr class="even">
<td><strong>CRISPS</strong></td>
<td>Crisps</td>
</tr>
<tr class="odd">
<td><strong>BREAD</strong></td>
<td>French bread</td>
</tr>
<tr class="even">
<td><strong>CHICKEN</strong></td>
<td>Chicken (roasted, served warm)</td>
</tr>
<tr class="odd">
<td><strong>RICE</strong></td>
<td>Rice (boiled, served warm)</td>
</tr>
<tr class="even">
<td><strong>CAESAR</strong></td>
<td>Caesar salad</td>
</tr>
<tr class="odd">
<td><strong>TOMATO</strong></td>
<td>Tomato salad</td>
</tr>
<tr class="even">
<td><strong>ICECREAM</strong></td>
<td>Vanilla ice-cream</td>
</tr>
<tr class="odd">
<td><strong>CAKE</strong></td>
<td>Chocolate cake</td>
</tr>
<tr class="even">
<td><strong>JUICE</strong></td>
<td>Orange juice</td>
</tr>
<tr class="odd">
<td><strong>WINE</strong></td>
<td>White wine</td>
</tr>
<tr class="even">
<td><strong>COFFEE</strong></td>
<td>Coffee</td>
</tr>
</tbody>
</table>

<p>Data is available for all forty-five guests at the luncheon. All of the variables are coded 1=yes, 2=no. Retrieve and attach the <code>bateman</code> dataset in <code>R</code>:</p>
<p> </p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb263-1" data-line-number="1">bateman &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;bateman.dat&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb263-2" data-line-number="2">bateman</a>
<a class="sourceLine" id="cb263-3" data-line-number="3"><span class="kw">attach</span>(bateman)</a></code></pre></div>
<pre><code>##   ILL CHEESE CRABDIP CRISPS BREAD CHICKEN RICE CAESAR TOMATO ICECREAM CAKE
## 1   1      1       1      1     2       1    1      1      1        1    1
## 2   2      1       1      1     2       1    2      2      2        1    1
## 3   1      2       2      1     2       1    2      1      2        1    1
## 4   1      1       2      1     1       1    2      1      2        1    1
## 5   1      1       1      1     2       1    1      1      1        2    1
## 6   1      1       1      1     1       1    2      1      1        2    1
##   JUICE WINE COFFEE
## 1     1    1      1
## 2     1    1      2
## 3     2    1      2
## 4     2    1      2
## 5     1    1      1
## 6     1    2      2</code></pre>
<pre><code>## The following objects are masked from salex:
## 
##     CRISPS, ILL, RICE, TOMATO</code></pre>
<p> </p>
<p>We will use our <code>tab2by2()</code> function to analyse this data. Retrieve this function:</p>
<p> </p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb266-1" data-line-number="1"><span class="kw">load</span>(<span class="st">&quot;tab2by2.r&quot;</span>)</a></code></pre></div>

<p>Use the <code>tab2by2()</code> function to analyse the data:</p>
<p> </p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb267-1" data-line-number="1"><span class="kw">tab2by2</span>(CHEESE, ILL)</a>
<a class="sourceLine" id="cb267-2" data-line-number="2"><span class="kw">tab2by2</span>(CRABDIP, ILL)</a>
<a class="sourceLine" id="cb267-3" data-line-number="3"><span class="kw">tab2by2</span>(CRISPS, ILL)</a>
<a class="sourceLine" id="cb267-4" data-line-number="4"><span class="kw">tab2by2</span>(BREAD, ILL)</a>
<a class="sourceLine" id="cb267-5" data-line-number="5"><span class="kw">tab2by2</span>(CHICKEN, ILL)</a>
<a class="sourceLine" id="cb267-6" data-line-number="6"><span class="kw">tab2by2</span>(RICE, ILL)</a>
<a class="sourceLine" id="cb267-7" data-line-number="7"><span class="kw">tab2by2</span>(CAESAR, ILL)</a>
<a class="sourceLine" id="cb267-8" data-line-number="8"><span class="kw">tab2by2</span>(TOMATO, ILL)</a>
<a class="sourceLine" id="cb267-9" data-line-number="9"><span class="kw">tab2by2</span>(ICECREAM, ILL)</a>
<a class="sourceLine" id="cb267-10" data-line-number="10"><span class="kw">tab2by2</span>(CAKE, ILL)</a>
<a class="sourceLine" id="cb267-11" data-line-number="11"><span class="kw">tab2by2</span>(JUICE, ILL)</a>
<a class="sourceLine" id="cb267-12" data-line-number="12"><span class="kw">tab2by2</span>(WINE, ILL)</a>
<a class="sourceLine" id="cb267-13" data-line-number="13"><span class="kw">tab2by2</span>(COFFEE, ILL)</a></code></pre></div>
<p> </p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb268-1" data-line-number="1"><span class="kw">tab2by2</span>(CHEESE, ILL)</a></code></pre></div>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 15  7
##        2 14  9
## 
## Relative Risk     : 1.12013 
## 95% CI            : 0.7253229 1.729838 
## 
## Sample Odds Ratio : 1.377551 
## 95% CI            : 0.4037553 4.699992 
## 
## MLE Odds Ratio    : 1.367743 
## 95% CI            : 0.3427732 5.649399</code></pre>

<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb270-1" data-line-number="1"><span class="kw">tab2by2</span>(CRABDIP, ILL)</a></code></pre></div>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 18  9
##        2 11  7
## 
## Relative Risk     : 1.090909 
## 95% CI            : 0.6921784 1.719329 
## 
## Sample Odds Ratio : 1.272727 
## 95% CI            : 0.3682028 4.3993 
## 
## MLE Odds Ratio    : 1.265848 
## 95% CI            : 0.3042941 5.188297</code></pre>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb272-1" data-line-number="1"><span class="kw">tab2by2</span>(CRISPS, ILL)</a></code></pre></div>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 21 12
##        2  8  4
## 
## Relative Risk     : 0.9545455 
## 95% CI            : 0.5930168 1.536478 
## 
## Sample Odds Ratio : 0.875 
## 95% CI            : 0.2170373 3.527619 
## 
## MLE Odds Ratio    : 0.8775841 
## 95% CI            : 0.1587568 4.184763</code></pre>

<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb274-1" data-line-number="1"><span class="kw">tab2by2</span>(BREAD, ILL)</a></code></pre></div>
<pre><code>## 
##         outcome
## exposure  1  2
##        1  9  8
##        2 20  8
## 
## Relative Risk     : 0.7411765 
## 95% CI            : 0.4469843 1.228997 
## 
## Sample Odds Ratio : 0.45 
## 95% CI            : 0.1280647 1.581232 
## 
## MLE Odds Ratio    : 0.4584416 
## 95% CI            : 0.1072622 1.897017</code></pre>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb276-1" data-line-number="1"><span class="kw">tab2by2</span>(CHICKEN, ILL)</a></code></pre></div>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 25 11
##        2  4  5
## 
## Relative Risk     : 1.5625 
## 95% CI            : 0.7293337 3.347448 
## 
## Sample Odds Ratio : 2.840909 
## 95% CI            : 0.637796 12.65415 
## 
## MLE Odds Ratio    : 2.76979 
## 95% CI            : 0.4912167 16.93409</code></pre>

<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb278-1" data-line-number="1"><span class="kw">tab2by2</span>(RICE, ILL)</a></code></pre></div>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 22 10
##        2  7  6
## 
## Relative Risk     : 1.276786 
## 95% CI            : 0.7330759 2.223756 
## 
## Sample Odds Ratio : 1.885714 
## 95% CI            : 0.5027038 7.073586 
## 
## MLE Odds Ratio    : 1.85813 
## 95% CI            : 0.4026256 8.531602</code></pre>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb280-1" data-line-number="1"><span class="kw">tab2by2</span>(CAESAR, ILL)</a></code></pre></div>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 26  5
##        2  3 11
## 
## Relative Risk     : 3.913978 
## 95% CI            : 1.418617 10.7987 
## 
## Sample Odds Ratio : 19.06667 
## 95% CI            : 3.866585 94.02038 
## 
## MLE Odds Ratio    : 17.33517 
## 95% CI            : 3.179027 133.7994</code></pre>

<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb282-1" data-line-number="1"><span class="kw">tab2by2</span>(TOMATO, ILL)</a></code></pre></div>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 24  6
##        2  5 10
## 
## Relative Risk     : 2.4 
## 95% CI            : 1.14769 5.018775 
## 
## Sample Odds Ratio : 8 
## 95% CI            : 1.97785 32.35836 
## 
## MLE Odds Ratio    : 7.553116 
## 95% CI            : 1.642249 41.02567</code></pre>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb284-1" data-line-number="1"><span class="kw">tab2by2</span>(ICECREAM, ILL)</a></code></pre></div>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 20  9
##        2  9  7
## 
## Relative Risk     : 1.226054 
## 95% CI            : 0.7463643 2.01404 
## 
## Sample Odds Ratio : 1.728395 
## 95% CI            : 0.4889138 6.110177 
## 
## MLE Odds Ratio    : 1.7069 
## 95% CI            : 0.4021245 7.255001</code></pre>

<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb286-1" data-line-number="1"><span class="kw">tab2by2</span>(CAKE, ILL)</a></code></pre></div>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 22 11
##        2  7  5
## 
## Relative Risk     : 1.142857 
## 95% CI            : 0.6689315 1.95255 
## 
## Sample Odds Ratio : 1.428571 
## 95% CI            : 0.3678242 5.548347 
## 
## MLE Odds Ratio    : 1.416945 
## 95% CI            : 0.2847257 6.685098</code></pre>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb288-1" data-line-number="1"><span class="kw">tab2by2</span>(JUICE, ILL)</a></code></pre></div>
<pre><code>## 
##         outcome
## exposure  1  2
##        1  8  5
##        2 21 11
## 
## Relative Risk     : 0.9377289 
## 95% CI            : 0.5701453 1.542301 
## 
## Sample Odds Ratio : 0.8380952 
## 95% CI            : 0.2206785 3.182927 
## 
## MLE Odds Ratio    : 0.8414367 
## 95% CI            : 0.185464 4.101313</code></pre>

<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb290-1" data-line-number="1"><span class="kw">tab2by2</span>(WINE, ILL)</a></code></pre></div>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 22 12
##        2  7  4
## 
## Relative Risk     : 1.016807 
## 95% CI            : 0.6099343 1.695094 
## 
## Sample Odds Ratio : 1.047619 
## 95% CI            : 0.2543383 4.315141 
## 
## MLE Odds Ratio    : 1.046515 
## 95% CI            : 0.1855742 5.186546</code></pre>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb292-1" data-line-number="1"><span class="kw">tab2by2</span>(COFFEE, ILL)</a></code></pre></div>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 17 11
##        2 12  5
## 
## Relative Risk     : 0.860119 
## 95% CI            : 0.5607997 1.319196 
## 
## Sample Odds Ratio : 0.6439394 
## 95% CI            : 0.1772875 2.338901 
## 
## MLE Odds Ratio    : 0.6502015 
## 95% CI            : 0.1388979 2.729586</code></pre>

<p>Two variables (<code>CAESAR</code> and <code>TOMATO</code>) are associated with <code>ILL</code>.</p>
<p>These two variables are also associated with each other:</p>
<p> </p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb294-1" data-line-number="1"><span class="kw">tab2by2</span>(CAESAR, TOMATO)</a>
<a class="sourceLine" id="cb294-2" data-line-number="2"><span class="kw">chisq.test</span>(<span class="kw">table</span>(CAESAR, TOMATO))</a>
<a class="sourceLine" id="cb294-3" data-line-number="3"><span class="kw">fisher.test</span>(<span class="kw">table</span>(CAESAR, TOMATO))</a></code></pre></div>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb295-1" data-line-number="1"><span class="kw">tab2by2</span>(CAESAR, TOMATO)</a></code></pre></div>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 27  4
##        2  3 11
## 
## Relative Risk     : 4.064516 
## 95% CI            : 1.477162 11.1838 
## 
## Sample Odds Ratio : 24.75 
## 95% CI            : 4.738936 129.2616 
## 
## MLE Odds Ratio    : 22.10962 
## 95% CI            : 3.850174 183.4671</code></pre>
<p> </p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb297-1" data-line-number="1"><span class="kw">chisq.test</span>(<span class="kw">table</span>(CAESAR, TOMATO))</a></code></pre></div>
<pre><code>## Warning in chisq.test(table(CAESAR, TOMATO)): Chi-squared approximation may
## be incorrect</code></pre>
<pre><code>## 
##  Pearson&#39;s Chi-squared test with Yates&#39; continuity correction
## 
## data:  table(CAESAR, TOMATO)
## X-squared = 15.877, df = 1, p-value = 6.759e-05</code></pre>

<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb300-1" data-line-number="1"><span class="kw">fisher.test</span>(<span class="kw">table</span>(CAESAR, TOMATO))</a></code></pre></div>
<pre><code>## 
##  Fisher&#39;s Exact Test for Count Data
## 
## data:  table(CAESAR, TOMATO)
## p-value = 3.442e-05
## alternative hypothesis: true odds ratio is not equal to 1
## 95 percent confidence interval:
##    3.850174 183.467108
## sample estimates:
## odds ratio 
##   22.10962</code></pre>
<p> </p>
<p>This suggests the potential for one of these associations to be due to confounding. We can perform a simple stratified analysis using the <code>table()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb302-1" data-line-number="1"><span class="kw">table</span>(CAESAR, ILL, TOMATO)</a></code></pre></div>
<pre><code>## , , TOMATO = 1
## 
##       ILL
## CAESAR  1  2
##      1 23  4
##      2  1  2
## 
## , , TOMATO = 2
## 
##       ILL
## CAESAR  1  2
##      1  3  1
##      2  2  9</code></pre>

<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb304-1" data-line-number="1"><span class="kw">table</span>(TOMATO, ILL, CAESAR)</a></code></pre></div>
<pre><code>## , , CAESAR = 1
## 
##       ILL
## TOMATO  1  2
##      1 23  4
##      2  3  1
## 
## , , CAESAR = 2
## 
##       ILL
## TOMATO  1  2
##      1  1  2
##      2  2  9</code></pre>
<p> </p>
<p>It would be useful to calculate odds ratios for each stratum. We can define a simple function to calculate an odds ratio from a two-by-two table:</p>
<p> </p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb306-1" data-line-number="1">or &lt;-<span class="st"> </span><span class="cf">function</span>(x) {(x[<span class="dv">1</span>,<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>x[<span class="dv">1</span>,<span class="dv">2</span>]) <span class="op">/</span><span class="st"> </span>(x[<span class="dv">2</span>,<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>x[<span class="dv">2</span>,<span class="dv">2</span>])}</a></code></pre></div>
<p> </p>
<p>We can use <code>apply()</code> to apply the <code>or()</code> function to the two-by-two table in each stratum:</p>
<p> </p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb307-1" data-line-number="1">tabC &lt;-<span class="st"> </span><span class="kw">table</span>(CAESAR, ILL, TOMATO)</a>
<a class="sourceLine" id="cb307-2" data-line-number="2"><span class="kw">apply</span>(tabC, <span class="dv">3</span>, or)</a></code></pre></div>
<pre><code>##    1    2 
## 11.5 13.5</code></pre>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb309-1" data-line-number="1">tabT &lt;-<span class="st"> </span><span class="kw">table</span>(TOMATO, ILL, CAESAR)</a>
<a class="sourceLine" id="cb309-2" data-line-number="2"><span class="kw">apply</span>(tabT, <span class="dv">3</span>, or)</a></code></pre></div>
<pre><code>##        1        2 
## 1.916667 2.250000</code></pre>
<p> </p>
<p>The 3 instructs the <code>apply()</code> function to apply the <code>or()</code> function to the third dimension of the table objects (i.e. levels of the potential confounder in <code>tabC</code> and <code>tabT</code>).</p>
<p>The <code>mantelhaen.test()</code> function performs the stratified analysis:</p>
<p> </p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb311-1" data-line-number="1"><span class="kw">mantelhaen.test</span>(tabC)</a></code></pre></div>
<pre><code>## 
##  Mantel-Haenszel chi-squared test with continuity correction
## 
## data:  tabC
## Mantel-Haenszel X-squared = 5.752, df = 1, p-value = 0.01647
## alternative hypothesis: true common odds ratio is not equal to 1
## 95 percent confidence interval:
##   1.878994 83.156212
## sample estimates:
## common odds ratio 
##              12.5</code></pre>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb313-1" data-line-number="1"><span class="kw">mantelhaen.test</span>(tabT)</a></code></pre></div>
<pre><code>## 
##  Mantel-Haenszel chi-squared test with continuity correction
## 
## data:  tabT
## Mantel-Haenszel X-squared = 0.049144, df = 1, p-value = 0.8246
## alternative hypothesis: true common odds ratio is not equal to 1
## 95 percent confidence interval:
##   0.3156862 13.4192331
## sample estimates:
## common odds ratio 
##          2.058219</code></pre>
<p> </p>
<p>It is likely that <code>CAESAR</code> salad was a vehicle of food-poisoning, and that <code>TOMATO</code> salad was not a vehicle of food-poisoning. Many of those at the luncheon ate both <code>CAESAR</code> salad and <code>TOMATO</code> salad. <code>CAESAR</code> confounded the relationship between <code>TOMATO</code> and <code>ILL</code>. This resulted in a spurious association between <code>TOMATO</code> and <code>ILL</code>.</p>
<p>It only makes sense to calculate a common odds ratio in the absence of interaction. We can check for interaction ‘by eye’ by examining and comparing the odds ratios for each stratum as we did above.</p>

<p>There does appear to be an interaction between <code>CAESAR</code>, <code>WINE</code>, and <code>ILL</code>:</p>
<p> </p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb315-1" data-line-number="1">tabW &lt;-<span class="st"> </span><span class="kw">table</span>(CAESAR, ILL, WINE)</a>
<a class="sourceLine" id="cb315-2" data-line-number="2"><span class="kw">apply</span>(tabW, <span class="dv">3</span>, or)</a></code></pre></div>
<pre><code>##    1    2 
## 63.0  2.5</code></pre>
<p> </p>
<p><em>Woolf’s test</em> for interaction (also known as <em>Woolf’s test for the homogeneity of odds ratios</em>) provides a formal test for interaction.</p>
<p><code>R</code> does not provide a function to perform <em>Woolf’s test</em> for the homogeneity of odds ratios but it is possible to write a function to perform this test.</p>
<p>First we will create a template for the function:</p>
<p> </p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb317-1" data-line-number="1">woolf.test &lt;-<span class="st"> </span><span class="cf">function</span>(x) {}</a></code></pre></div>
<p> </p>
<p>And then use the <code>fix()</code> function to edit the <code>woolf.test()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb318-1" data-line-number="1"><span class="kw">fix</span>(woolf.test)</a></code></pre></div>
<p> </p>
<p>We can now edit this function to make it do something useful:</p>
<p> </p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb319-1" data-line-number="1"><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb319-2" data-line-number="2">  x &lt;-<span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span></a>
<a class="sourceLine" id="cb319-3" data-line-number="3">  k &lt;-<span class="st"> </span><span class="kw">dim</span>(x)[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb319-4" data-line-number="4">  or &lt;-<span class="st"> </span><span class="kw">apply</span>(x, <span class="dv">3</span>, <span class="cf">function</span>(x)</a>
<a class="sourceLine" id="cb319-5" data-line-number="5">              {(x[<span class="dv">1</span>, <span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>x[<span class="dv">1</span>, <span class="dv">2</span>]) <span class="op">/</span><span class="st"> </span>(x[<span class="dv">2</span>, <span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>x[<span class="dv">2</span>, <span class="dv">2</span>])})</a>
<a class="sourceLine" id="cb319-6" data-line-number="6">  w &lt;-<span class="st"> </span><span class="kw">apply</span>(x, <span class="dv">3</span>, <span class="cf">function</span>(x) {<span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>x)})</a>
<a class="sourceLine" id="cb319-7" data-line-number="7">  chi.sq &lt;-<span class="st"> </span><span class="kw">sum</span>(w <span class="op">*</span><span class="st"> </span>(<span class="kw">log</span>(or) <span class="op">-</span><span class="st"> </span><span class="kw">weighted.mean</span>(<span class="kw">log</span>(or), w))<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb319-8" data-line-number="8">  p &lt;-<span class="st"> </span><span class="kw">pchisq</span>(chi.sq, <span class="dt">df =</span> k <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb319-9" data-line-number="9">  <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Woolf&#39;s X2 :&quot;</span>, chi.sq,</a>
<a class="sourceLine" id="cb319-10" data-line-number="10">      <span class="st">&quot;</span><span class="ch">\n</span><span class="st">p-value    :&quot;</span>, p, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb319-11" data-line-number="11">}</a></code></pre></div>

<p>Once you have made the changes shown above, check your work, save the file, and quit the editor.
We can use the <code>woolf.test()</code> function to test for a three-way interaction between <code>CAESAR</code>, <code>WINE</code>, and <code>ILL</code>:</p>
<p> </p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb320-1" data-line-number="1"><span class="kw">woolf.test</span>(tabW)</a></code></pre></div>
<p> </p>
<p>Which returns:</p>
<p> </p>
<pre><code>## 
## Woolf&#39;s X2 : 3.319492 
## p-value    : 0.06846297</code></pre>
<p> </p>
<p>Which is weak evidence of an interaction.</p>
<p>We should test for interaction between <code>CAESAR</code>, <code>TOMATO</code>, and <code>ILL</code> before accepting the results reported by
the <code>mantelhaen.test()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb322-1" data-line-number="1"><span class="kw">woolf.test</span>(tabC)</a></code></pre></div>
<pre><code>## 
## Woolf&#39;s X2 : 0.0001233783 
## p-value    : 0.9911376</code></pre>
<p> </p>
<p>We can repeat this analysis using logistic regression.</p>

<p>We need to change the coding of the variables to 0 and 1 before specifying the model:</p>
<p> </p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb324-1" data-line-number="1"><span class="kw">detach</span>(bateman)</a>
<a class="sourceLine" id="cb324-2" data-line-number="2">bateman &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>bateman</a>
<a class="sourceLine" id="cb324-3" data-line-number="3">bateman</a>
<a class="sourceLine" id="cb324-4" data-line-number="4">bateman.lreg &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="dt">formula =</span> ILL <span class="op">~</span><span class="st"> </span>CAESAR <span class="op">+</span><span class="st"> </span>TOMATO,</a>
<a class="sourceLine" id="cb324-5" data-line-number="5">                    <span class="dt">family =</span> <span class="kw">binomial</span>(logit), <span class="dt">data =</span> bateman)</a>
<a class="sourceLine" id="cb324-6" data-line-number="6"><span class="kw">summary</span>(bateman.lreg)</a>
<a class="sourceLine" id="cb324-7" data-line-number="7">bateman.lreg &lt;-<span class="st"> </span><span class="kw">update</span>(bateman.lreg, . <span class="op">~</span><span class="st"> </span>. <span class="op">-</span><span class="st"> </span>TOMATO)</a>
<a class="sourceLine" id="cb324-8" data-line-number="8"><span class="kw">summary</span>(bateman.lreg)</a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = ILL ~ CAESAR + TOMATO, family = binomial(logit), 
##     data = bateman)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.960  -0.641   0.563   0.563   1.835  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)  -1.4780     0.7101  -2.082  0.03739 * 
## CAESAR        2.5202     0.9653   2.611  0.00904 **
## TOMATO        0.7197     0.9552   0.753  0.45116   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 58.574  on 44  degrees of freedom
## Residual deviance: 41.408  on 42  degrees of freedom
## AIC: 47.408
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<pre><code>## 
## Call:
## glm(formula = ILL ~ CAESAR, family = binomial(logit), data = bateman)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.9103  -0.6945   0.5931   0.5931   1.7552  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -1.2993     0.6513  -1.995 0.046066 *  
## CAESAR        2.9479     0.8141   3.621 0.000293 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 58.574  on 44  degrees of freedom
## Residual deviance: 41.940  on 43  degrees of freedom
## AIC: 45.94
## 
## Number of Fisher Scoring iterations: 4</code></pre>

<p>Interactions are specified using the multiply (<code>*</code>) symbol in the model formula:</p>
<p> </p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb327-1" data-line-number="1">bateman.lreg &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="dt">formula =</span> ILL <span class="op">~</span><span class="st"> </span>CAESAR <span class="op">+</span><span class="st"> </span>WINE <span class="op">+</span><span class="st"> </span>CAESAR <span class="op">*</span><span class="st"> </span>WINE,</a>
<a class="sourceLine" id="cb327-2" data-line-number="2">                    <span class="dt">family =</span> <span class="kw">binomial</span>(logit), <span class="dt">data =</span> bateman)</a>
<a class="sourceLine" id="cb327-3" data-line-number="3"><span class="kw">summary</span>(bateman.lreg)</a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = ILL ~ CAESAR + WINE + CAESAR * WINE, family = binomial(logit), 
##     data = bateman)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.0393  -0.4590   0.5168   0.5168   2.1460  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept) -1.092e-15  1.000e+00   0.000   1.0000  
## CAESAR       9.163e-01  1.304e+00   0.703   0.4822  
## WINE        -2.197e+00  1.453e+00  -1.512   0.1305  
## CAESAR:WINE  3.227e+00  1.787e+00   1.806   0.0709 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 58.574  on 44  degrees of freedom
## Residual deviance: 38.508  on 41  degrees of freedom
## AIC: 46.508
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p> </p>
<p>Before we continue, it is probably a good idea to save the <code>woolf.test()</code> function for later use:</p>
<p> </p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb329-1" data-line-number="1"><span class="kw">save</span>(woolf.test, <span class="dt">file =</span> <span class="st">&quot;woolf.r&quot;</span>)</a></code></pre></div>
<p> </p>
<div id="matched-data" class="section level2">
<h2><span class="header-section-number">3.1</span> Matched data</h2>
<p><em>Matching</em> is another way to control for the effects of potential confounding variables. Matching is usually performed during data-collection as part of the design of a study.</p>
<p>In a matched case-control studies, each case is matched with one or more controls which are chosen to have the same values over a set of potential confounding variables.
In order to illustrate how matched data may be analysed using tabulation and stratification in <code>R</code> we will start with the simple case of one-to-one matching (i.e. each case has a single matched control):</p>
<p> </p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb330-1" data-line-number="1">octe &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;octe.dat&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb330-2" data-line-number="2">octe[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, ]</a></code></pre></div>
<pre><code>##    ID CASE OC
## 1   1    1  1
## 2   1    2  1
## 3   2    1  1
## 4   2    2  1
## 5   3    1  1
## 6   3    2  1
## 7   4    1  1
## 8   4    2  1
## 9   5    1  1
## 10  5    2  1</code></pre>
<p> </p>
<p>This data is from a matched case-control study investigating the association between oral contraceptive use and thromboembolism. The cases are 175 women aged between 15 and 44 years admitted to hospital for thromboembolism and discharged alive. The controls are female patients admitted for conditions believed to be unrelated to oral contraceptive use. Cases and controls were matched on age, ethnic group, marital status, parity, income, place of residence, and date of hospitalisation. The variables in the dataset are:</p>

<table>
<colgroup>
<col width="20%" />
<col width="79%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>ID</strong></td>
<td>Identifier for the matched sets of cases and controls</td>
</tr>
<tr class="even">
<td><strong>CASE</strong></td>
<td>Case (1) or control (2)</td>
</tr>
<tr class="odd">
<td><strong>OC</strong></td>
<td>Used oral contraceptives in the previous month (1=yes, 2=no)</td>
</tr>
</tbody>
</table>
<p> </p>
<p>The dataset consists of 350 records:</p>
<p> </p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb332-1" data-line-number="1"><span class="kw">nrow</span>(octe)</a></code></pre></div>
<pre><code>## [1] 350</code></pre>
<p> </p>
<p>There are 175 matched sets of cases and controls:</p>
<p> </p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb334-1" data-line-number="1"><span class="kw">length</span>(<span class="kw">unique</span>(octe<span class="op">$</span>ID))</a></code></pre></div>
<pre><code>## [1] 175</code></pre>
<p> </p>
<p>In each matched set of cases and controls there is one case and one control:</p>
<p> </p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb336-1" data-line-number="1"><span class="kw">table</span>(octe<span class="op">$</span>ID, octe<span class="op">$</span>CASE)</a></code></pre></div>
<pre><code>##     
##      1 2
##   1  1 1
##   2  1 1
##   3  1 1
##   4  1 1
##   5  1 1
##   6  1 1
##   7  1 1
##   8  1 1
##   9  1 1
##   10 1 1</code></pre>

<p>This data may be analysed using <em>McNemar’s chi-squared test</em> which use the number of discordant (i.e. relative to exposure) pairs of matched cases and controls.</p>
<p>To find the number of discordant pairs we need to split the dataset into cases and controls:</p>
<p> </p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb338-1" data-line-number="1">octe.cases &lt;-<span class="st"> </span><span class="kw">subset</span>(octe, CASE <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb338-2" data-line-number="2">octe.controls &lt;-<span class="st"> </span><span class="kw">subset</span>(octe, CASE <span class="op">==</span><span class="st"> </span><span class="dv">2</span>)</a></code></pre></div>
<p> </p>
<p>Sorting these two datasets (i.e. <code>octe.cases</code> and <code>octe.controls</code>) by the <code>ID</code> variable simplifies the analysis:</p>
<p> </p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb339-1" data-line-number="1">octe.cases &lt;-<span class="st"> </span>octe.cases[<span class="kw">order</span>(octe.cases<span class="op">$</span>ID), ]</a>
<a class="sourceLine" id="cb339-2" data-line-number="2">octe.controls &lt;-<span class="st"> </span>octe.controls[<span class="kw">order</span>(octe.controls<span class="op">$</span>ID), ]</a></code></pre></div>
<p> </p>
<p>Since the two datasets (i.e. <code>octe.cases</code> and <code>octe.controls</code>) are now sorted by the <code>ID</code> variable we can use the <code>table()</code> function to retrieve the number if concordant and discordant pairs and store them in a table object:</p>
<p> </p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb340-1" data-line-number="1">tab &lt;-<span class="st"> </span><span class="kw">table</span>(octe.cases<span class="op">$</span>OC, octe.controls<span class="op">$</span>OC)</a>
<a class="sourceLine" id="cb340-2" data-line-number="2">tab</a></code></pre></div>
<pre><code>##    
##      1  2
##   1 10 57
##   2 13 95</code></pre>
<p> </p>
<p>This table object (i.e. <code>tab</code>) can then be passed to the <code>mcnemar.test()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb342-1" data-line-number="1"><span class="kw">mcnemar.test</span>(tab)</a></code></pre></div>
<pre><code>## 
##  McNemar&#39;s Chi-squared test with continuity correction
## 
## data:  tab
## McNemar&#39;s chi-squared = 26.414, df = 1, p-value = 2.755e-07</code></pre>
<p> </p>
<p>The <code>mcnemar.test()</code> function does not provide an estimate of the odds ratio. This is the ratio of the discordant pairs:</p>
<p> </p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb344-1" data-line-number="1">r &lt;-<span class="st"> </span>tab[<span class="dv">1</span>,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb344-2" data-line-number="2">s &lt;-<span class="st"> </span>tab[<span class="dv">2</span>,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb344-3" data-line-number="3">rdp &lt;-<span class="st"> </span>r <span class="op">/</span><span class="st"> </span>s</a>
<a class="sourceLine" id="cb344-4" data-line-number="4">rdp</a></code></pre></div>
<pre><code>## [1] 4.384615</code></pre>
<p> </p>
<p>A confidence interval can also be calculated:</p>
<p> </p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb346-1" data-line-number="1">ci.p &lt;-<span class="st"> </span><span class="kw">binom.test</span>(r, r <span class="op">+</span><span class="st"> </span>s)<span class="op">$</span>conf.int</a>
<a class="sourceLine" id="cb346-2" data-line-number="2">ci.rdp &lt;-<span class="st"> </span>ci.p <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>ci.p)</a>
<a class="sourceLine" id="cb346-3" data-line-number="3">ci.rdp</a></code></pre></div>
<pre><code>## [1] 2.371377 8.731311
## attr(,&quot;conf.level&quot;)
## [1] 0.95</code></pre>
<p> </p>
<p>This provides a 95% confidence interval. Other (e.g. 99%) confidence intervals can be produced by specifying appropriate values for the <code>conf.level</code> parameter of the <code>binom.test()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb348-1" data-line-number="1">ci.p &lt;-<span class="st"> </span><span class="kw">binom.test</span>(r, r <span class="op">+</span><span class="st"> </span>s, <span class="dt">conf.level =</span> <span class="fl">0.99</span>)<span class="op">$</span>conf.int</a>
<a class="sourceLine" id="cb348-2" data-line-number="2">ci.rdp &lt;-<span class="st"> </span>ci.p <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>ci.p)</a>
<a class="sourceLine" id="cb348-3" data-line-number="3">ci.rdp</a></code></pre></div>
<pre><code>## [1]  2.010478 10.949095
## attr(,&quot;conf.level&quot;)
## [1] 0.99</code></pre>

<p>An alternative way of analysing this data is to use the <code>mantelhaen.test()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb350-1" data-line-number="1">tab &lt;-<span class="st"> </span><span class="kw">table</span>(octe<span class="op">$</span>OC, octe<span class="op">$</span>CASE, octe<span class="op">$</span>ID)</a>
<a class="sourceLine" id="cb350-2" data-line-number="2"><span class="kw">mantelhaen.test</span>(tab)</a></code></pre></div>
<pre><code>## 
##  Mantel-Haenszel chi-squared test with continuity correction
## 
## data:  tab
## Mantel-Haenszel X-squared = 26.414, df = 1, p-value = 2.755e-07
## alternative hypothesis: true common odds ratio is not equal to 1
## 95 percent confidence interval:
##  2.400550 8.008521
## sample estimates:
## common odds ratio 
##          4.384615</code></pre>
<p> </p>
<p>The Mantel-Haenszel approach is preferred because it can be used with data from matched case-control studies that match more than one control to each case. Multiple matching is useful when the condition being studied is rare or at the early stages of an outbreak (i.e. when cases are hard to find and controls are easy to find).</p>
<p>We will now work with some data where each case has one or more controls:</p>
<p> </p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb352-1" data-line-number="1">tsstamp &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;tsstamp.dat&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb352-2" data-line-number="2">tsstamp</a></code></pre></div>
<pre><code>##    ID CASE RBTAMP
## 1   1    1      1
## 2   1    2      1
## 3   1    2      1
## 4   2    1      1
## 5   2    2      2
## 6   2    2      1
## 7   2    2      1
## 8   3    1      2
## 9   3    2      2
## 10  3    2      1
## 11  4    1      1
## 12  4    2      2
## 13  5    1      1
## 14  5    2      1
## 15  5    2      2
## 16  6    1      1
## 17  6    2      1
## 18  7    1      1
## 19  7    2      2
## 20  7    2      2
## 21  8    1      1
## 22  8    2      1
## 23  8    2      2
## 24  9    1      2
## 25  9    2      1
## 26  9    2      2
## 27  9    2      2
## 28 10    1      1
## 29 10    2      2
## 30 10    2      2
## 31 11    1      1
## 32 11    2      2
## 33 11    2      2
## 34 12    1      1
## 35 12    2      2
## 36 12    2      2
## 37 12    2      2
## 38 13    1      1
## 39 13    2      2
## 40 13    2      2
## 41 14    1      2
## 42 14    2      2
## 43 14    2      2</code></pre>
<p> </p>
<p>This data is from a matched case-control study investigating the association between the use of different brands of tampon and toxic shock syndrome undertaken during an outbreak. Only a subset of the original dataset is used here. The variables in the dataset are:</p>

<table>
<colgroup>
<col width="20%" />
<col width="79%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>ID</strong></td>
<td>Identifier for the matched sets of cases and controls</td>
</tr>
<tr class="even">
<td><strong>CASE</strong></td>
<td>Case (1) or control (2)</td>
</tr>
<tr class="odd">
<td><strong>RBTAMP</strong></td>
<td>Used Rely brand tampons (1=yes, 2=no)</td>
</tr>
</tbody>
</table>
<p> </p>
<p>The dataset consists of forty-three (43) records:</p>
<p> </p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb354-1" data-line-number="1"><span class="kw">nrow</span>(tsstamp)</a></code></pre></div>
<pre><code>## [1] 43</code></pre>
<p> </p>
<p>There are fourteen (14) matched sets of cases and controls:</p>
<p> </p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb356-1" data-line-number="1"><span class="kw">length</span>(<span class="kw">unique</span>(tsstamp<span class="op">$</span>ID))</a></code></pre></div>
<pre><code>## [1] 14</code></pre>
<p> </p>
<p>Each matched set of cases and controls consists of one case and one or more controls:</p>
<p> </p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb358-1" data-line-number="1"><span class="kw">table</span>(tsstamp<span class="op">$</span>ID, tsstamp<span class="op">$</span>CASE)</a></code></pre></div>
<pre><code>##     
##      1 2
##   1  1 2
##   2  1 3
##   3  1 2
##   4  1 1
##   5  1 2
##   6  1 1
##   7  1 2
##   8  1 2
##   9  1 3
##   10 1 2
##   11 1 2
##   12 1 3
##   13 1 2
##   14 1 2</code></pre>
<p> </p>
<p>The <em>McNemar’s chi-squared test</em> is not useful for this data as it is limited to the special case of one-to-one matching.</p>
<p>Analysing this data using a simple tabulation such as:</p>
<p> </p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb360-1" data-line-number="1"><span class="kw">fisher.test</span>(<span class="kw">table</span>(tsstamp<span class="op">$</span>RBTAMP, tsstamp<span class="op">$</span>CASE))</a></code></pre></div>
<pre><code>## 
##  Fisher&#39;s Exact Test for Count Data
## 
## data:  table(tsstamp$RBTAMP, tsstamp$CASE)
## p-value = 0.007805
## alternative hypothesis: true odds ratio is not equal to 1
## 95 percent confidence interval:
##   1.542686 53.734756
## sample estimates:
## odds ratio 
##   7.709932</code></pre>
<p> </p>
<p>ignores the matched nature of the data and is, therefore, also not useful for this data.</p>
<p>The matched nature of the data may be accounted by stratifying on the variable that identifies the matched sets
of cases and controls (i.e. the <code>ID</code> variable) using the <code>mantelhaen.test()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb362-1" data-line-number="1"><span class="kw">mantelhaen.test</span>(<span class="kw">table</span>(tsstamp<span class="op">$</span>RBTAMP, tsstamp<span class="op">$</span>CASE, tsstamp<span class="op">$</span>ID))</a></code></pre></div>
<pre><code>## 
##  Mantel-Haenszel chi-squared test with continuity correction
## 
## data:  table(tsstamp$RBTAMP, tsstamp$CASE, tsstamp$ID)
## Mantel-Haenszel X-squared = 5.9384, df = 1, p-value = 0.01481
## alternative hypothesis: true common odds ratio is not equal to 1
## 95 percent confidence interval:
##   1.589505 43.191463
## sample estimates:
## common odds ratio 
##          8.285714</code></pre>
<p> </p>
<p>Analysis of several risk factors or adjustment for confounding variables not matched for in the design of a matched case-control study cannot be performed using tabulation-based procedures such as the <code>McNemar's chi- squared test</code> and Mantel-Haenszel procedures. In these situations a special form of logistic regression, called <code>conditional logistic regression</code>, should be used.</p>
<p>We can now quit <code>R</code>:</p>
<p> </p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb364-1" data-line-number="1"><span class="kw">q</span>()</a></code></pre></div>
<p> </p>
<p>For this exercise there is no need to save the workspace image so click the <strong>No</strong> or <strong>Don’t Save</strong> button (GUI) or enter <code>n</code> when prompted to save the workspace image (terminal).</p>
</div>
<div id="summary-2" class="section level2">
<h2><span class="header-section-number">3.2</span> Summary</h2>
<ul>
<li><p><code>R</code> provides functions for many kinds of complex statistical analysis. We have looked at using the generalised linear model <code>glm()</code> function to perform logistic regression. We have looked ar the <code>mantelhaen.test()</code> function to perform stratified analyses and the <code>mantelhaen.test()</code> and <code>mcnemar.test()</code> functions to analyse data from matched case-control studies.</p></li>
<li><p><code>R</code> can be extended by writing new functions. New functions can perform simple or complex data analysis. New functions can be composed of parts of existing function. New functions can be saved and used in subsequent <code>R</code> sessions. By building your own functions you can use <code>R</code> to build your own statistical analysis system.</p></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exercise2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exercise4.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["prfe.pdf", "prfe.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
